var LineTool=function(a){this.drawingMode="line",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket,this.fabricCanvas.isDrawingMode=!1,this.fabricCanvas.on("object:added",function(a){"labeled-line"===a.target.type&&this.setActiveObject(a.target)})};LineTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},LineTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.strokeWidth=b.strokeWidth||6;var c=this.fabricCanvas.getPointer(a.e),d=[c.x,c.y,c.x,c.y];this.placeHolder=new fabric.Line(d,{strokeWidth:this.strokeWidth,strokeDashArray:[5,3],stroke:this.currentColor,fill:"",originX:"center",originY:"center"}),this.fabricCanvas.add(this.placeHolder)},LineTool.prototype.onMouseMove=function(a){var b=this.fabricCanvas.getPointer(a.e);this.placeHolder.set({x2:b.x,y2:b.y}),this.fabricCanvas.renderAll()},LineTool.prototype.onMouseUp=function(){this.render(),this.fabricCanvas.remove(this.placeHolder)},LineTool.prototype.render=function(){var a=new fabric.LabeledLine([this.placeHolder.x1,this.placeHolder.y1,this.placeHolder.x2,this.placeHolder.y2],{drawingId:this.drawingId,strokeWidth:this.strokeWidth,fill:"",stroke:this.currentColor,originX:"center",originY:"center"});this.socket.emit("addObject",a)};var RectangleTool=function(a){this.drawingMode="rectangle",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket,this.fabricCanvas.on("object:added",function(a){"labeled-rect"===a.target.type&&this.setActiveObject(a.target)})};RectangleTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},RectangleTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.stroke=b.currentColor,this.strokeWidth=b.strokeWidth||1;var c=this.fabricCanvas.getPointer(a.e);this.placeHolder=new fabric.Rect({strokeWidth:this.strokeWidth,strokeDashArray:[5,3],stroke:this.currentColor,fill:"",top:c.y,left:c.x,originY:"top",originX:"left"}),this.fabricCanvas.add(this.placeHolder)},RectangleTool.prototype.onMouseMove=function(a){var b=this.fabricCanvas.getPointer(a.e),c=b.x-this.placeHolder.left,d=b.y-this.placeHolder.top;this.placeHolder.width=c,this.placeHolder.height=d,this.fabricCanvas.renderAll()},RectangleTool.prototype.onMouseUp=function(){this.render(),this.fabricCanvas.remove(this.placeHolder)},RectangleTool.prototype.render=function(){var a=new fabric.LabeledRect({drawingId:this.drawingId,left:this.placeHolder.left,top:this.placeHolder.top,originX:"left",originY:"top",width:this.placeHolder.width,height:this.placeHolder.height,fill:"",stroke:this.currentColor,strokeWidth:this.strokeWidth});this.socket.emit("addObject",a)};var TriangleTool=function(a){this.drawingMode="rectangle",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket,this.fabricCanvas.on("object:added",function(a){"labeled-triangle"===a.target.type&&this.setActiveObject(a.target)})};TriangleTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},TriangleTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.strokeWidth=b.strokeWidth||1;var c=this.fabricCanvas.getPointer(a.e);this.placeHolder=new fabric.Triangle({strokeWidth:this.strokeWidth,strokeDashArray:[5,3],stroke:this.currentColor,fill:"",top:c.y,left:c.x,height:1,width:1,originY:"top",originX:"left"}),this.fabricCanvas.add(this.placeHolder)},TriangleTool.prototype.onMouseMove=function(a){var b=this.fabricCanvas.getPointer(a.e),c=b.x-this.placeHolder.left,d=b.y-this.placeHolder.top;this.placeHolder.width=c,this.placeHolder.height=d,this.fabricCanvas.renderAll()},TriangleTool.prototype.onMouseUp=function(){this.render(),this.fabricCanvas.remove(this.placeHolder)},TriangleTool.prototype.render=function(){var a=new fabric.LabeledTriangle({drawingId:this.drawingId,left:this.placeHolder.left,top:this.placeHolder.top,originX:"left",originY:"top",width:this.placeHolder.width,height:this.placeHolder.height,fill:"",stroke:this.currentColor,strokeWidth:this.strokeWidth});this.socket.emit("addObject",a)};var CircleTool=function(a){this.drawingMode="circle",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket,this.fabricCanvas.on("object:added",function(a){"labeled-circle"===a.target.type&&this.setActiveObject(a.target)})};CircleTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},CircleTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.strokeWidth=b.strokeWidth||1;var c=this.fabricCanvas.getPointer(a.e);this.placeHolder=new fabric.Circle({strokeWidth:this.strokeWidth,strokeDashArray:[5,3],stroke:this.currentColor,fill:"",radius:1,top:c.y,left:c.x,originY:"center",originX:"center"}),this.fabricCanvas.add(this.placeHolder)},CircleTool.prototype.onMouseMove=function(a){var b=this.fabricCanvas.getPointer(a.e),c=this.placeHolder.left-b.x,d=this.placeHolder.top-b.y;this.placeHolder.radius=Math.sqrt(c*c+d*d),this.fabricCanvas.renderAll()},CircleTool.prototype.onMouseUp=function(){this.render(),this.fabricCanvas.remove(this.placeHolder)},CircleTool.prototype.render=function(){var a=new fabric.LabeledCircle({drawingId:this.drawingId,left:this.placeHolder.left,top:this.placeHolder.top,originX:"center",originY:"center",radius:this.placeHolder.radius,fill:"",stroke:this.currentColor,strokeWidth:this.strokeWidth});this.socket.emit("addObject",a)};var FreeDrawingTool=function(a){this.drawingMode="free",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket;var b=this;this.fabricCanvas.on("path:created",function(a){console.log("path created"),b.possiblyDirty=!0,b.onPathCreated(a)}),this.fabricCanvas.on("object:added",function(a){"labeled-path"===a.target.type&&this.setActiveObject(a.target)})};FreeDrawingTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!0},FreeDrawingTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.strokeWidth=b.strokeWidth||6},FreeDrawingTool.prototype.onMouseMove=function(){},FreeDrawingTool.prototype.onMouseUp=function(){},FreeDrawingTool.prototype.onPathCreated=function(a){var b=new fabric.LabeledPath(a.path.path);b.set(a.path),b.set({type:"labeled-path"}),b.set({drawingId:this.drawingId}),b.set({stroke:this.currentColor}),this.fabricCanvas.remove(a.path),this.socket.emit("addObject",b.toObject(["drawingId"]))};var TextTool=function(a){this.drawingMode="text",this.drawingId=a.drawingId,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket;var b=this;this.fabricCanvas.on("text:changed",function(a){console.log(a.target.text),b.socket.emit("text-changing",a.target),b.socket.emit("saveDrawing",b.fabricCanvas)}),this.socket.on("text-changing",function(a){if("labeled-i-text"===a.type){var c=b.fabricCanvas.findById(a._id);b.fabricCanvas.setActiveObject(c),c.text!==a.text&&(console.log(c.text+" in the socket"),c.text=a.text,b.fabricCanvas.renderAll()),b.fabricCanvas.setActiveObject(c),c.enterEditing()}}),this.fabricCanvas.on("object:added",function(a){"labeled-i-text"===a.target.type&&(this.setActiveObject(a.target),a.target.enterEditing())})};TextTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},TextTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor,this.strokeWidth=b.strokeWidth||6;var c=this.fabricCanvas.getPointer(a.e);this.placeHolder=new fabric.LabeledIText("",{drawingId:this.drawingId,left:c.x,top:c.y,padding:7})},TextTool.prototype.onMouseMove=function(){},TextTool.prototype.onMouseUp=function(){this.socket.emit("addObject",this.placeHolder)};var FillTool=function(a){this.drawingMode="fill",this.drawingId=a.drawingId,this.currentColor=a.currentColor,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket};FillTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},FillTool.prototype.onMouseDown=function(a,b){this.currentColor=b.currentColor},FillTool.prototype.onMouseMove=function(){},FillTool.prototype.onMouseUp=function(){this.fabricCanvas.getActiveObject()&&(this.fabricCanvas.getActiveObject().fill=this.currentColor,this.socket.emit("changing",this.fabricCanvas.getActiveObject()),this.fabricCanvas.renderAll(),this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll())};var DefaultTool=function(a){this.drawingMode="default",this.drawingId=a.drawingId,this.currentColor=a.currentColor,this.fabricCanvas=a.fabricCanvas,this.socket=a.socket};DefaultTool.prototype.init=function(){this.fabricCanvas.isDrawingMode=!1},DefaultTool.prototype.onMouseDown=function(){},DefaultTool.prototype.onMouseMove=function(){},DefaultTool.prototype.onMouseUp=function(){};